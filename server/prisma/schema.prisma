generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  TRAINER
  MEMBER
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
}

model User {
  id                    String        @id @default(uuid())
  name                  String
  email                 String        @unique
  passwordHash          String
  role                  Role          @default(MEMBER)
  status                UserStatus    @default(ACTIVE)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  workoutPlansCreated   WorkoutPlan[] @relation("WorkoutPlansCreated")
  workoutPlansAssigned  WorkoutPlan[] @relation("WorkoutPlansAssigned")
  dietPlansCreated      DietPlan[]    @relation("DietPlansCreated")
  dietPlansAssigned     DietPlan[]    @relation("DietPlansAssigned")
  subscriptions         Subscription[]
  progressEntries       Progress[]    @relation("ProgressForMember")
  progressRecorded      Progress[]    @relation("ProgressRecordedBy")
}

model WorkoutPlan {
  id           String   @id @default(uuid())
  title        String
  description  String
  createdById  String
  assignedToId String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  createdBy  User  @relation("WorkoutPlansCreated", fields: [createdById], references: [id], onDelete: Restrict)
  assignedTo User? @relation("WorkoutPlansAssigned", fields: [assignedToId], references: [id], onDelete: SetNull)
}

model DietPlan {
  id           String   @id @default(uuid())
  title        String
  description  String
  createdById  String
  assignedToId String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  createdBy  User  @relation("DietPlansCreated", fields: [createdById], references: [id], onDelete: Restrict)
  assignedTo User? @relation("DietPlansAssigned", fields: [assignedToId], references: [id], onDelete: SetNull)
}

model Subscription {
  id        String             @id @default(uuid())
  userId    String
  planName  String
  startDate DateTime
  endDate   DateTime
  status    SubscriptionStatus @default(ACTIVE)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Restrict)
}

model Progress {
  id           String   @id @default(uuid())
  userId       String
  recordedById String
  weight       Float?
  bodyFat      Float?
  bmi          Float?
  notes        String?
  recordedAt   DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user       User @relation("ProgressForMember", fields: [userId], references: [id], onDelete: Restrict)
  recordedBy User @relation("ProgressRecordedBy", fields: [recordedById], references: [id], onDelete: Restrict)
}
